roles=$*
gitroot="/usr/local/git_tree/main"
sshopts=""
myhost=`hostname`
if [[ $myhost == *booking.com* ]]
then
   sshopts='ssh shell-201.lhr4.corp.booking.com ssh-proxy %h %p'
fi

if [ -z "$roles" ]
then
   if [[ $myhost == *booking.com* ]]
   then
       roles=`mysqly sysctl -B -e 'select distinct server_role from deploy' 2>/dev/null | tr '\n' ' '`
   else
       roles=`ssh cron-staging.prod.booking.com PERL5LIB=$gitroot/lib "mysqly sysctl -B -e 'select distinct server_role from deploy'" 2>/dev/null | tr '\n' ' '`
   fi
fi

for role in $roles
do
    hostname="$role-staging.prod.booking.com"
    host "$hostname">/dev/null && printf "\n$hostname ($role):\n" && ssh -o StrictHostKeyChecking=no -o ProxyCommand="$sshopts" $hostname "cd $gitroot && umask 0002 && git-deploy status 2>&1 && exit" 2>/dev/null
done